<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Strict Focus App</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, system-ui, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      transition: background 0.5s ease;
      user-select: none;
      touch-action: auto;
    }

    h1, h2, h3 {
      font-weight: 600;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    }

    h1 {
      font-size: 3rem;
      margin: 32px 0;
    }

    h2 {
      font-size: 2.2rem;
      margin: 24px 0;
    }

    h3 {
      font-size: 1.8rem;
      margin: 16px 0;
    }

    label {
      font-size: 1.3rem;
      margin: 8px 0;
    }

    input, button, select {
      margin: 16px;
      padding: 18px 36px;
      font-size: 1.3rem;
      border: none;
      border-radius: 14px;
      transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
      pointer-events: auto;
      min-width: 160px;
      touch-action: auto;
    }

    input[type="number"], input[type="text"] {
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      text-align: center;
      width: 160px;
    }

    input[type="text"]#customWarning {
      width: 240px;
    }

    select {
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      width: 200px;
    }

    button {
      background: linear-gradient(45deg, #34d399, #2dd4bf);
      color: white;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }

    button:disabled {
      background: #4b5563;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #lockScreen, #breakScreen, #historyScreen, #summary, #exitConfirmation {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
      color: white;
      z-index: 9999;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.5s ease-in;
      touch-action: none;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9998;
      pointer-events: auto;
      touch-action: auto;
    }

    #emergencyButton, #breakButton {
      background: linear-gradient(45deg, #ef4444, #f87171);
      animation: pulseEmergency 2s infinite;
    }

    @keyframes pulseEmergency {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #timer {
      font-size: 4.5rem;
      font-weight: 700;
      margin: 32px 0;
      text-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
      z-index: 10001;
      transition: transform 0.2s;
    }

    @keyframes tick {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    #warning {
      color: #f87171;
      font-weight: 600;
      margin: 32px 0;
      font-size: 1.5rem;
      animation: pulse 1.5s infinite;
      max-width: 90%;
      z-index: 10000;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    #controls {
      display: flex;
      gap: 20px;
      z-index: 10000;
      flex-wrap: wrap;
      justify-content: center;
    }

    #summary, #historyScreen, #exitConfirmation {
      background: #2a2a2a;
      padding: 32px;
      border-radius: 18px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    #historyList {
      list-style: none;
      padding: 0;
      text-align: left;
      max-width: 100%;
    }

    #historyList li {
      margin: 16px 0;
      padding: 16px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      font-size: 1.2rem;
    }

    @media (max-width: 600px) {
      h1 { font-size: 2.5rem; }
      h2 { font-size: 1.9rem; }
      h3 { font-size: 1.6rem; }
      #timer { font-size: 3.5rem; }
      label { font-size: 1.2rem; }
      input, button, select { 
        font-size: 1.1rem; 
        padding: 14px 28px; 
        min-width: 140px;
      }
      input[type="number"], input[type="text"] { width: 140px; }
      input[type="text"]#customWarning { width: 200px; }
      select { width: 180px; }
      #warning { font-size: 1.3rem; }
      #summary, #historyScreen, #exitConfirmation { font-size: 1.1rem; padding: 24px; }
      #historyList li { font-size: 1rem; }
    }

    @media (max-width: 400px) {
      h1 { font-size: 2.1rem; }
      h2 { font-size: 1.6rem; }
      h3 { font-size: 1.4rem; }
      #timer { font-size: 3rem; }
      label { font-size: 1.1rem; }
      input, button, select { 
        font-size: 1rem; 
        padding: 12px 24px; 
        min-width: 120px;
      }
      input[type="number"], input[type="text"] { width: 120px; }
      input[type="text"]#customWarning { width: 180px; }
      select { width: 160px; }
      #warning { font-size: 1.2rem; }
      #summary, #historyScreen, #exitConfirmation { font-size: 1rem; padding: 20px; }
      #historyList li { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <h1>🔒 Strict Focus Mode</h1>
  <label for="minutes">Focus Duration (minutes):</label>
  <input type="number" id="minutes" value="25" min="1" max="180" />
  <label for="breakMinutes">Break Duration (minutes):</label>
  <input type="number" id="breakMinutes" value="5" min="1" max="60" />
  <label for="customWarning">Custom Warning Message:</label>
  <input type="text" id="customWarning" placeholder="Stay focused!" maxlength="100" />
  <label for="alarmSound">Alarm Sound:</label>
  <select id="alarmSound">
    <option value="default">Default Alarm</option>
    <option value="beep">Beep</option>
    <option value="chime">Chime</option>
  </select>
  <div>
    <label><input type="checkbox" id="soundToggle" checked> Enable Sound</label>
  </div>
  <button onclick="startFocus()">Start Focus</button>
  <button onclick="showHistory()">View History</button>

  <div id="lockScreen">
    <div id="overlay"></div>
    <h2>🚫 Stay Focused!</h2>
    <div id="timer">--:--</div>
    <div id="warning"></div>
    <div id="controls">
      <button id="pauseButton" onclick="pauseFocus()">Pause</button>
      <button id="continueButton" onclick="continueFocus()">Continue</button>
      <button id="breakButton" onclick="startBreak()">Take Break</button>
      <button id="emergencyButton" onclick="showExitConfirmation()">Emergency Exit</button>
    </div>
  </div>

  <div id="breakScreen">
    <div id="overlay"></div>
    <h2>☕ Break Time!</h2>
    <div id="timer">--:--</div>
    <div id="warning"></div>
    <div id="controls">
      <button id="continueButton" onclick="continueBreak()">Continue</button>
      <button id="skipBreakButton" onclick="endBreak()">Skip Break</button>
    </div>
  </div>

  <div id="exitConfirmation">
    <h3>Confirm Exit</h3>
    <p>Type "exit" to end focus mode:</p>
    <input type="text" id="exitInput" style="width: 160px;" />
    <div style="display: flex; gap: 20px; margin-top: 20px;">
      <button onclick="confirmExit()">Confirm</button>
      <button onclick="cancelExit()">Cancel</button>
    </div>
  </div>

  <div id="summary">
    <h3>Focus Session Summary</h3>
    <p id="summaryText"></p>
    <button onclick="closeSummary()">Close</button>
  </div>

  <div id="historyScreen">
    <h3>Focus History</h3>
    <ul id="historyList"></ul>
    <button onclick="closeHistory()">Close</button>
  </div>

  <audio id="alarmDefault" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>
  <audio id="alarmBeep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
  <audio id="alarmChime" src="https://actions.google.com/sounds/v1/alarms/chime.ogg" preload="auto"></audio>

  <script>
    let endTime, interval, totalDuration, isPaused = false, isFocusMode = false, pauseStartTime, interruptions = 0, startTime, mode = 'focus', focusRemaining = 0;

    function startFocus() {
      const minutes = parseInt(document.getElementById("minutes").value);
      const breakMinutes = parseInt(document.getElementById("breakMinutes").value);
      if (!minutes || minutes <= 0 || !breakMinutes || breakMinutes <= 0) {
        alert("Enter valid times for focus and break");
        return;
      }

      totalDuration = minutes * 60 * 1000;
      startTime = Date.now();
      endTime = startTime + totalDuration;
      isPaused = false;
      isFocusMode = true;
      mode = 'focus';
      interruptions = 0;
      document.getElementById("lockScreen").style.display = "flex";
      document.getElementById("breakScreen").style.display = "none";
      document.getElementById("warning").textContent = "";
      document.getElementById("pauseButton").style.display = "inline-block";
      document.getElementById("continueButton").style.display = "none";
      document.getElementById("breakButton").style.display = "inline-block";
      document.getElementById("minutes").disabled = true;
      document.getElementById("breakMinutes").disabled = true;
      document.getElementById("customWarning").disabled = true;
      document.getElementById("alarmSound").disabled = true;
      document.querySelector("button[onclick='startFocus()']").disabled = true;
      document.querySelector("button[onclick='showHistory()']").disabled = true;
      document.body.style.pointerEvents = "none";
      document.body.style.touchAction = "none";
      document.getElementById("lockScreen").style.pointerEvents = "none";
      document.getElementById("lockScreen").style.touchAction = "none";
      document.getElementById("pauseButton").style.pointerEvents = "auto";
      document.getElementById("pauseButton").style.touchAction = "auto";
      document.getElementById("continueButton").style.pointerEvents = "auto";
      document.getElementById("continueButton").style.touchAction = "auto";
      document.getElementById("breakButton").style.pointerEvents = "auto";
      document.getElementById("breakButton").style.touchAction = "auto";
      document.getElementById("emergencyButton").style.pointerEvents = "auto";
      document.getElementById("emergencyButton").style.touchAction = "auto";
      localStorage.setItem("lastDuration", minutes);
      localStorage.setItem("lastBreakDuration", breakMinutes);
      updateTimer();
      document.body.requestFullscreen().catch(() => console.log("Fullscreen request failed"));
      interval = setInterval(updateTimer, 1000);
      console.log("Focus mode started");
      if (navigator.vibrate) navigator.vibrate(100);
      lockOrientation();
    }

    function updateTimer() {
      if (isPaused) return;

      const now = Date.now();
      const remaining = endTime - now;

      if (remaining <= 0) {
        clearInterval(interval);
        document.getElementById("timer").textContent = mode === 'focus' ? "✅ Time's Up!" : "🏁 Break Over!";
        playAlarm();
        if (mode === 'focus') {
          setTimeout(showSummary, 4000);
        } else {
          setTimeout(endBreak, 4000);
        }
        return;
      }

      const mins = Math.floor(remaining / 60000);
      const secs = Math.floor((remaining % 60000) / 1000);
      document.getElementById("timer").textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      document.getElementById("timer").style.animation = "tick 1s";

      setTimeout(() => {
        document.getElementById("timer").style.animation = "";
      }, 1000);
    }

    function pauseFocus() {
      if (!isFocusMode || mode !== 'focus') return;
      isPaused = true;
      clearInterval(interval);
      pauseStartTime = Date.now();
      document.getElementById("warning").textContent = "⏸️ Focus Paused";
      document.getElementById("pauseButton").style.display = "none";
      document.getElementById("breakButton").style.display = "none";
      document.getElementById("continueButton").style.display = "inline-block";
      console.log("Focus paused");
      if (navigator.vibrate) navigator.vibrate(100);
    }

    function continueFocus() {
      if (!isFocusMode || mode !== 'focus') return;
      isPaused = false;
      const pauseDuration = Date.now() - pauseStartTime;
      endTime += pauseDuration;
      document.getElementById("warning").textContent = "";
      document.getElementById("pauseButton").style.display = "inline-block";
      document.getElementById("breakButton").style.display = "inline-block";
      document.getElementById("continueButton").style.display = "none";
      interval = setInterval(updateTimer, 1000);
      console.log("Focus resumed");
      if (navigator.vibrate) navigator.vibrate(100);
    }

    function startBreak() {
      if (!isFocusMode || mode !== 'focus') return;
      isPaused = true;
      clearInterval(interval);
      focusRemaining = endTime - Date.now();
      const breakMinutes = parseInt(document.getElementById("breakMinutes").value);
      if (!breakMinutes || breakMinutes <= 0) {
        alert("Invalid break duration");
        return;
      }
      totalDuration = breakMinutes * 60 * 1000;
      startTime = Date.now();
      endTime = startTime + totalDuration;
      isPaused = false;
      mode = 'break';
      document.getElementById("lockScreen").style.display = "none";
      document.getElementById("breakScreen").style.display = "flex";
      document.getElementById("warning").textContent = "";
      document.getElementById("continueButton").style.display = "none";
      document.getElementById("skipBreakButton").style.display = "inline-block";
      document.getElementById("skipBreakButton").style.pointerEvents = "auto";
      document.getElementById("skipBreakButton").style.touchAction = "auto";
      document.body.requestFullscreen().catch(() => console.log("Fullscreen request failed"));
      updateTimer();
      interval = setInterval(updateTimer, 1000);
      console.log("Break mode started");
      if (navigator.vibrate) navigator.vibrate(100);
    }

    function continueBreak() {
      if (!isFocusMode || mode !== 'break') return;
      isPaused = false;
      const pauseDuration = Date.now() - pauseStartTime;
      endTime += pauseDuration;
      document.getElementById("warning").textContent = "";
      document.getElementById("continueButton").style.display = "none";
      document.getElementById("skipBreakButton").style.display = "inline-block";
      interval = setInterval(updateTimer, 1000);
      console.log("Break resumed");
      if (navigator.vibrate) navigator.vibrate(100);
    }

    function endBreak() {
      clearInterval(interval);
      document.getElementById("breakScreen").style.display = "none";
      mode = 'focus';
      endTime = Date.now() + focusRemaining;
      isPaused = false;
      document.getElementById("lockScreen").style.display = "flex";
      document.getElementById("warning").textContent = "";
      document.getElementById("pauseButton").style.display = "inline-block";
      document.getElementById("breakButton").style.display = "inline-block";
      document.getElementById("continueButton").style.display = "none";
      document.body.requestFullscreen().catch(() => console.log("Fullscreen request failed"));
      updateTimer();
      interval = setInterval(updateTimer, 1000);
      console.log("Break mode ended, focus resumed");
      if (navigator.vibrate) navigator.vibrate(100);
    }

    function showExitConfirmation() {
      if (!isFocusMode) return;
      document.getElementById("exitConfirmation").style.display = "block";
      document.getElementById("exitInput").value = "";
      document.getElementById("exitInput").style.pointerEvents = "auto";
      document.getElementById("exitInput").style.touchAction = "auto";
      document.querySelector("#exitConfirmation button[onclick='confirmExit()']").style.pointerEvents = "auto";
      document.querySelector("#exitConfirmation button[onclick='confirmExit()']").style.touchAction = "auto";
      document.querySelector("#exitConfirmation button[onclick='cancelExit()']").style.pointerEvents = "auto";
      document.querySelector("#exitConfirmation button[onclick='cancelExit()']").style.touchAction = "auto";
    }

    function confirmExit() {
      if (document.getElementById("exitInput").value.toLowerCase() === "exit") {
        document.getElementById("exitConfirmation").style.display = "none";
        endFocus();
      } else {
        alert("Please type 'exit' to confirm.");
      }
    }

    function cancelExit() {
      document.getElementById("exitConfirmation").style.display = "none";
    }

    function endFocus() {
      clearInterval(interval);
      document.exitFullscreen().catch(() => console.log("Exit fullscreen failed"));
      document.getElementById("lockScreen").style.display = "none";
      document.getElementById("breakScreen").style.display = "none";
      document.getElementById("minutes").disabled = false;
      document.getElementById("breakMinutes").disabled = false;
      document.getElementById("customWarning").disabled = false;
      document.getElementById("alarmSound").disabled = false;
      document.querySelector("button[onclick='startFocus()']").disabled = false;
      document.querySelector("button[onclick='showHistory()']").disabled = false;
      document.body.style.pointerEvents = "auto";
      document.body.style.touchAction = "auto";
      document.getElementById("lockScreen").style.pointerEvents = "none";
      document.getElementById("lockScreen").style.touchAction = "none";
      document.getElementById("breakScreen").style.pointerEvents = "none";
      document.getElementById("breakScreen").style.touchAction = "none";
      isPaused = false;
      isFocusMode = false;
      mode = 'focus';
      document.getElementById("timer").textContent = "--:--";
      document.getElementById("pauseButton").style.display = "inline-block";
      document.getElementById("continueButton").style.display = "none";
      document.getElementById("breakButton").style.display = "inline-block";
      saveSession();
      showSummary();
      unlockOrientation();
      console.log("Focus mode ended");
    }

    function handleUnauthorizedInteraction() {
      if (!isFocusMode || isPaused) return;
      isPaused = true;
      interruptions++;
      clearInterval(interval);
      pauseStartTime = Date.now();
      const customMsg = document.getElementById("customWarning").value.trim() || "Stay focused!";
      document.getElementById("warning").textContent = `⚠️ Unauthorized interaction detected! ${customMsg} Press Continue to resume.`;
      if (mode === 'focus') {
        document.getElementById("pauseButton").style.display = "none";
        document.getElementById("breakButton").style.display = "none";
        document.getElementById("continueButton").style.display = "inline-block";
      } else {
        document.getElementById("skipBreakButton").style.display = "none";
        document.getElementById("continueButton").style.display = "inline-block";
      }
      console.log("Unauthorized interaction detected");
      if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
    }

    function playAlarm() {
      if (!document.getElementById("soundToggle").checked) return;
      const sound = document.getElementById("alarmSound").value;
      const audio = document.getElementById(`alarm${sound.charAt(0).toUpperCase() + sound.slice(1)}`);
      audio.play().catch(() => console.log("Audio playback failed"));
    }

    function saveSession() {
      const totalTime = (Date.now() - startTime) / 60000;
      const session = {
        date: new Date().toLocaleString(),
        duration: totalTime.toFixed(1),
        interruptions: interruptions,
      };
      let sessions = JSON.parse(localStorage.getItem("focusSessions") || "[]");
      sessions.push(session);
      localStorage.setItem("focusSessions", JSON.stringify(sessions));
    }

    function showSummary() {
      const totalTime = (Date.now() - startTime) / 60000;
      const summaryText = `Session Duration: ${totalTime.toFixed(1)} minutes\nInterruptions: ${interruptions}`;
      document.getElementById("summaryText").textContent = summaryText;
      document.getElementById("summary").style.display = "block";
      document.querySelector("#summary button[onclick='closeSummary()']").style.pointerEvents = "auto";
      document.querySelector("#summary button[onclick='closeSummary()']").style.touchAction = "auto";
    }

    function closeSummary() {
      document.getElementById("summary").style.display = "none";
    }

    function showHistory() {
      const sessions = JSON.parse(localStorage.getItem("focusSessions") || "[]");
      const historyList = document.getElementById("historyList");
      historyList.innerHTML = "";
      sessions.forEach((session) => {
        const li = document.createElement("li");
        li.textContent = `Date: ${session.date}, Duration: ${session.duration} min, Interruptions: ${session.interruptions}`;
        historyList.appendChild(li);
      });
      document.getElementById("historyScreen").style.display = "flex";
      document.querySelector("#historyScreen button").style.pointerEvents = "auto";
      document.querySelector("#historyScreen button").style.touchAction = "auto";
    }

    function closeHistory() {
      document.getElementById("historyScreen").style.display = "none";
    }

    function lockOrientation() {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("portrait").catch(() => console.log("Orientation lock failed"));
      }
    }

    function unlockOrientation() {
      if (screen.orientation && screen.orientation.unlock) {
        screen.orientation.unlock();
      }
    }

    // Block all keyboard interactions
    document.addEventListener("keydown", (e) => {
      if (isFocusMode && e.target.id !== "emergencyButton" && e.target.id !== "pauseButton" && e.target.id !== "continueButton" && e.target.id !== "breakButton" && e.target.id !== "skipBreakButton" && e.target.id !== "exitInput" && !e.target.closest("#exitConfirmation")) {
        e.preventDefault();
        handleUnauthorizedInteraction();
      }
    });

    // Block all mouse clicks except on allowed elements
    document.addEventListener("click", (e) => {
      if (isFocusMode && e.target.id !== "emergencyButton" && e.target.id !== "pauseButton" && e.target.id !== "continueButton" && e.target.id !== "breakButton" && e.target.id !== "skipBreakButton" && !e.target.closest("#exitConfirmation") && !e.target.closest("#summary") && !e.target.closest("#historyScreen")) {
        e.preventDefault();
        handleUnauthorizedInteraction();
      }
    });

    // Block all touch interactions except on allowed elements
    document.addEventListener("touchstart", (e) => {
      if (isFocusMode && e.target.id !== "emergencyButton" && e.target.id !== "pauseButton" && e.target.id !== "continueButton" && e.target.id !== "breakButton" && e.target.id !== "skipBreakButton" && !e.target.closest("#exitConfirmation") && !e.target.closest("#summary") && !e.target.closest("#historyScreen")) {
        e.preventDefault();
        handleUnauthorizedInteraction();
      }
    });

    // Detect tab switching
    document.addEventListener("visibilitychange", () => {
      if (isFocusMode && document.hidden) {
        handleUnauthorizedInteraction();
      }
    });

    // Prevent new tab/window shortcuts
    document.addEventListener("keydown", (e) => {
      if (isFocusMode) {
        if ((e.ctrlKey && (e.key === 't' || e.key === 'T' || e.key === 'n' || e.key === 'N')) ||
            (e.metaKey && (e.key === 't' || e.key === 'T' || e.key === 'n' || e.key === 'N'))) {
          e.preventDefault();
          handleUnauthorizedInteraction();
        }
      }
    });

    window.onload = () => {
      const lastDuration = localStorage.getItem("lastDuration");
      const lastBreakDuration = localStorage.getItem("lastBreakDuration");
      if (lastDuration) document.getElementById("minutes").value = lastDuration;
      if (lastBreakDuration) document.getElementById("breakMinutes").value = lastBreakDuration;
      document.body.style.touchAction = "auto";
      console.log("Page loaded");
    };
  </script>
</body>
</html>
